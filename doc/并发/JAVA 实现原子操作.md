JAVA 中一般通过锁和循环CAS 的方式来实现原子操作

### 使用循环CAS 来实现原子操作
JVM 的CAS 操作是利用了处理器提供的CMPXCHG 指令实现的 ，CAS虽然很高效地解决了原子操作，但是 CAS 仍然存在三个大问题 1.ABA 问题 2. 循环时间长，开销大。3. 只能保证一个共享变量的原子操作

1.  ABA 问题。 因为CAS需要在操作值的时候，检查值有没有发生变化，如果没有变化则更新，但是如果一个值原来是A ，变成B 又变成A 。，那么CAS 进行检查时会发现它的值没有发生变化，但是 实际上却发生了变化 。而 ABA 的解决方法则是在变量前追加版本号。 每次更新的时候把版本号加1
2.  循环时间长，开销大 自旋CAS 如果长时间不成功，会给CPU 带来非常大的执行开销
3.  只能保证一个共享变量的原子操作。当对一个共享变量执行操作时，可以使用循环CAS 的方式来保证原子操作。但是对多个共享变量操作时，循环CAS就无法保证操作的原子性。这个时候可以使用锁来解决

### 使用锁来实现原子操作
锁机制保证了只有获得锁的线程才能够操作锁定的内存区域，JVM内部实现了多种锁机制，但是 ，除了偏向锁，JVM 锁的实现方法都使用了循环CAS ，即当一个线程想进入同步块的时候使用循环CAS 的方式来获取锁，当他退出同步块的时候，使用循环CAS 释放锁

