栈帧是用来存储数据和部分过程结果的数据结果，同时也用来处理动态连接，方法返回值和异常分派。栈帧随着方法调用而创建，随着方法结束而销毁--无论方法是正常王朝还是异常完成，都算做方法结束，栈帧的存储空间由创建他的线程分配在Java虚拟机栈。 每一个栈帧都有自己的本地变量表，操作数栈，和指向当前方法所属的运行时常量池的引用

当某个线程在执行过程中的某个时间点上，只有目前正在执行的那个方法的栈帧是活动的，这个栈帧称为当前栈帧，这个栈帧对应的方法称为当前方法，定义这个方法的类称为当前类，对局部变量表和操作数栈的各种操作，通常都是指对当前栈帧的局部变量表和操作数栈进行的操作

如果当前方法调用了其他方法，或者当前方法执行结束，那么这个方法的栈帧就不再是当前栈帧了，调用新的方法时，新的栈帧也会随之创建，并且会随着程序控制权移交到新方法而称为新的当前栈帧，方法返回之际，当前栈帧会传回此方法的执行结果给前一个栈帧，然后虚拟机会丢弃当前栈帧，使得前一个栈帧重新称为当前栈帧

需要注意的是，栈帧是线程本地私有的数据，不可能在一个栈帧之中引用另外一个线程的栈帧

### 局部变量表

每个栈帧内部都包含一组称为局部变量表的变量列表，栈帧中局部变量表的长度由编译器决定，并且存储于类或接口的二进制表示之中，即通过方法的code属性保存及提供给栈帧使用

个局部变量可以保存一个类型为 boolean ，byte char  short  int  float reference 或 returnaddress  的数据，两个局部变量可以保存一个类型为 long 或double 类型的数据

局部变量表使用索引来进行定位访问，首个局部变量的索引值为0，局部变量的索引值是个整数，他以零开始，小于局部变量表的长度。 long 和double 类型的数据占用两个连续的局部变量，这两种类型的数据值采用两个局部变量中较小的索引值来定位。

java 虚拟机使用局部变量表来完成方法调用时的参数传递，调用方法时，他的参数会一次传递到局部变量表中从0开始的连续位置上，当调用实例方法时，第0 个局部变量一定用来存储该实例方法所在对象的引用，后续的其他参数将会传递至局部变量表中从 I 开始的连续位置上

### 操作数栈
每个栈帧内部都包含一个称为操作数栈的先进先出 栈栈帧中操作数栈的最大深度由编译器决定，并且通过方法的code 属性保存及提供给栈帧使用

栈帧在刚刚创建的时候，操作数栈是空的，Java虚拟机提供一些字节码指令从局部变量表 或者对象实例的字段中复制常量或变量值到操作数栈中，也提供了一些指令用于从操作数栈取走数据，操作数据以及把操作结果重新入站，在调用方法时，操作数栈也用来准备调用方法的参数以及接受方法返回结果

在操作数栈中的数据必须正确地操作，例如入栈为两个int 类型的数据，结果不能为long行，简单来说，就是不同类型的数据不能做操作

在任何时候，操作数栈都会有一个确定的栈深度，一个long 或者double 类型的数据会占用两个单位的栈深度，其他数据类型则会占用一个单位的栈深度

### 动态链接
每一个栈帧内部都包含一个指向当前方法所在类型的运行时常量池的引用，以便对当前方法的代码实现动态链接，在class 文件中，一个方法若要调用其他方法或者访问成员变量，则需要通过符号引用来表示，动态链接的作用就是将这些以符号引用的所表示的方法转换为对实际方法的直接引用。由于对其他类中的方法和变量进行了晚期绑定，所以即便那些类发生了变化，也不会影响调用他的方法

### 方法返回地址
当一个方法开始执行后，只有两个方式可以退出这个方法，第一种方式是执行引擎遇到任意一个方法返回的字节码指令。这个时候就可能有返回值传递给上层的方法调用者（调用当前方法的方法），是否有返回值和返回值的类型根据遇到何种方法返回指令来决定，这种退出方法的方式称为正常完成出口

另外一种退出方式是，在方法执行过程中遇到了一次，并且这个异常无法在方法体内得到处理，无论是Java虚拟机内部产生的异常，还是代码中使用 athrow 字节码指令产生的异常，只要在本方法的异常表没有搜索到匹配的异常处理器，就会导致方法退出，这种退出方式称为异常完成出口，一个方法使用异常完成出口的方式，是不会给它的上层调用者产生任何返回值 

无论采用何种方式退出，在方法退出之后，都需要返回方法被调用的位置，程序才能继续执行，方法返回时可能需要在帧栈中保存一些信息，用来帮助恢复它的上层方法的执行状态。 一般来说，方法正常退出时，调用者的PC计数器的值可以作为返回值，栈帧中可能会保存这个计数器值。 而方法异常退出时，返回地址是要通过异常处理器表来确定的。栈帧一般不会保存这部分信息

方法退出的过程实际上就等同于把当前栈帧出栈，因此退出时可能执行的操作有。 恢复上层方法的局部变量表和操作数栈，然后把返回值（如果有的话）压入调用者栈帧的操作数栈中，调整PC 计数器的值以指向方法调用者指令后面的一条指令等

### 附加信息

虚拟机规范运行具体的虚拟机实现增加一些规范里没有描述的信息到栈帧之中。在实际开发中，一般会把动态连接，方法返回地址与其他附加信息全部归为一类，称为栈帧信息